<!doctype html>
<html lang="en-us">
  <head>
    <title>Setting Up a Malware Analysis Environment // Andr01d Rocks</title>
    <link rel="shortcut icon" href="/images/avatar.png" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Q" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.f56e26c1ca281286b7f30d2b731cfcaca1eb911107d65e03e2201027b10036e9.css" />

    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XQ0Q91QYR3"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-XQ0Q91QYR3', { 'anonymize_ip': false });
}
</script>

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Setting Up a Malware Analysis Environment"/>
<meta name="twitter:description" content="Summary This is not meant to be a step by step tutorial rather I wanted to make a good listing of the most useful tools I am using daily for malware analysis. In order to do malware analysis on android we only need 3&#43;1 things. A computer, right tools, a malware sample (and brains). In this post I will help you setup a malware analysis Virtual Machine with all essential tools to get you started."/>

    <meta property="og:title" content="Setting Up a Malware Analysis Environment" />
<meta property="og:description" content="Summary This is not meant to be a step by step tutorial rather I wanted to make a good listing of the most useful tools I am using daily for malware analysis. In order to do malware analysis on android we only need 3&#43;1 things. A computer, right tools, a malware sample (and brains). In this post I will help you setup a malware analysis Virtual Machine with all essential tools to get you started." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://andr01d.rocks/posts/setting-up-a-malware-analysis-env/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-22T03:22:59+04:00" />
<meta property="article:modified_time" content="2023-04-22T03:22:59+04:00" />

    

  </head>
  <body>
    <header class="app-header">
      <a href="https://andr01d.rocks/"><img class="app-header-avatar" src="/images/avatar.png" alt="Q" /></a>
      <span class="app-header-title">Andr01d Rocks</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">Home</a>
            •
          
          <a class="app-header-menu-item" href="/about/">About</a>
            •
          
          <a class="app-header-menu-item" href="/other/">Offtopic</a>
            •
          
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>Android shenanigans.</p>
      <div class="app-header-social">
        
          <a href="https://github.com/basilhskk" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>Github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg>
          </a>
        
          <a href="https://twitter.com/qu3st1on_" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
          <a href="mailto:contact@andr01d.rocks" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-mail">
  <title>Email</title>
  <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Setting Up a Malware Analysis Environment</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Apr 22, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          5 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://andr01d.rocks/tags/malware-analysis/">malware-analysis</a>
              <a class="tag" href="https://andr01d.rocks/tags/linux/">linux</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h3 id="summary">Summary</h3>
<p>This is not meant to be a step by step tutorial rather I wanted to make a good listing of the most useful tools I am using daily for malware analysis. In order to do malware analysis on android we only need 3+1 things. A computer, right tools, a malware sample (and brains). In this post I will help you setup a malware analysis Virtual Machine with all essential tools to get you started. This post by all means does not cover all available tools.</p>
<p><strong>Please note</strong>: I am demonstrating the following tools on linux environment, this doesn&rsquo;t mean you can use the same tools on other operating systems like Windows or MacOS. Most of the tools described in this post are cross-platform.</p>
<h3 id="linux-installation">Linux installation</h3>
<p>I will not go as far as to make a tutorial of how to setup a virtual machine and install a linux distribution, since it has been done by many others. I will try to cover as much as possible of the tools I use and the installation process but if you find yourself stuck at any point of this post a simple google search will most certainly answer your questions. <strong>Google is your best buddy</strong> if you are doing anything related with computers, so google every question you have, you will be amazed how many other people had the same Q.</p>
<p>For this post shake lets just use ubuntu since is one of the most common distributions. What I usually like to do is to keep the installation as clean as possible and de-bloat the standard installation. For this reason we are going to use a very useful script [01] running the following command we are going to invoke the script using curl. This is a personalization step, hence you can choose what you want or don&rsquo;t want.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>curl -sSL https://raw.githubusercontent.com/terminalforlife/Extra/master/source/simplify-ubuntu/simplify-ubuntu | sh
</span></span></code></pre></div><h3 id="essential-tools">Essential Tools</h3>
<p>This section covers almost mandatory tools you need to have in order to work with android malware. We can separate the malware analysis in two (2) parts, Static Analysis and Dynamic Analysis. I am going to follow this separation and add one more layer of seperation, the essential tools. Essential tools are tools not directly connected with malware or reverse engineering (RE).</p>
<p>List of tools: [android studio, android platform-tools, aapt, apktool, VScode, Recaf]</p>
<p>Android Studio[02] is the official IDE for creating android applications.</p>
<p>First we have to install the dependencies and then download and install the android studio. The preferred location for tool will be <code>/opt/</code> for this post.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo apt-get install libc6:i386 libncurses5:i386 libstdc++6:i386 lib32z1 libbz2-1.0:i386
</span></span><span style="display:flex;"><span><span style="color:#75715e"># download android studio from https://developer.android.com/studio </span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># extract</span>
</span></span><span style="display:flex;"><span>tar -xvzf /path/to/tarball/android-studio-XXXX-linux.tar.gz
</span></span><span style="display:flex;"><span><span style="color:#75715e"># move to opt</span>
</span></span><span style="display:flex;"><span>mv android-studio/ /opt/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># run</span>
</span></span><span style="display:flex;"><span>./opt/android-studio/bin/studio.sh
</span></span></code></pre></div><p>Android sdk platform tools [03] contains Android Debug Bridge (ADB) and fastboot [04]. Those tools are essential in order to connect to android devices or emulators. Further more we will need Android Asset Packaging Tool (AAAPT) [05] and apktool too. AAAPT and apktool will aid us in the future in order to decompile and recompile android packages (apk).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo apt-get install -y android-sdk-platform-tools aapt apktool apktool
</span></span></code></pre></div><p>Some other useful tools would be a good IDE of choice (I prefer VScode) and a good byte code editor we are going to use Recaf [06].</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># download vscode https://code.visualstudio.com/Download</span>
</span></span><span style="display:flex;"><span>sudo dpkg --install /path/to/code_XXXX.deb
</span></span><span style="display:flex;"><span><span style="color:#75715e"># we are going to instal JDK and JRE since we are going to need those in the future too</span>
</span></span><span style="display:flex;"><span>sudo apt-get install -y default-jre default-jdk 
</span></span><span style="display:flex;"><span><span style="color:#75715e"># download recaf from https://github.com/Col-E/Recaf/releases/latest</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># download the recaf-XXX-jar-with-dependencies.jar</span>
</span></span><span style="display:flex;"><span>mkdir /opt/recaf
</span></span><span style="display:flex;"><span>mv /path/to/downloaded/recaf /opt/recaf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to run recaf</span>
</span></span><span style="display:flex;"><span>java -jar /opt/recaf/recaf-XXX-jar-with-dependencies.jar
</span></span></code></pre></div><h3 id="static-analysis-tools">Static Analysis Tools</h3>
<p>For static analysis tool</p>
<p>Ghidra or Ida for native parts of an application (shared libraries). I prefer ghidra since its my hobby and dont have access to a licensed IDA.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># download the https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_10.2.2_build/ghidra_10.2.2_PUBLIC_20221115.zip</span>
</span></span><span style="display:flex;"><span>unzip /path/to/ghidra 
</span></span><span style="display:flex;"><span>mv ghidra_10.2.2_PUBLIC /opt/
</span></span><span style="display:flex;"><span><span style="color:#75715e"># install ghidra frida hook generator https://github.com/CENSUS/ghidra-frida-hook-gen/tree/main/dist [07]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># install https://github.com/Ayrx/JNIAnalyzer [08]</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/zackelia/ghidra-dark <span style="color:#f92672">[</span>09<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>cd ghidra-dark 
</span></span><span style="display:flex;"><span>python3 install.py
</span></span></code></pre></div><p>jadx-gui one of the best free dex to java decompilers. If you have license for JEB go with JEB.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>git clone https://github.com/skylot/jadx
</span></span><span style="display:flex;"><span>cd jadx
</span></span><span style="display:flex;"><span>./gradlew dist
</span></span><span style="display:flex;"><span>mv build/jadx/bin /opt/jadx
</span></span></code></pre></div><h3 id="dynamic-analysis-tools">Dynamic Analysis Tools</h3>
<p>Frida for binary instrumentation.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># download the frida server https://github.com/frida/frida/releases according with the emulator/device architecture that you are going to run frida on.</span>
</span></span><span style="display:flex;"><span>python3 -m pip install frida-tools
</span></span></code></pre></div><p><a href="https://portswigger.net/burp/communitydownload">Burp suite</a> download and install burp its an installer. We are gonna use burp to intercept traffic of the application during dynamic analysis.</p>
<p>Some worth mentioning tools are the following:</p>
<ul>
<li><a href="https://github.com/MobSF/Mobile-Security-Framework-MobSF">MobSF</a></li>
<li><a href="https://github.com/Ch0pin/medusa">Medusa</a></li>
</ul>
<h3 id="emulation--device-options">Emulation / Device options</h3>
<p>We need a device or an emulator to run the sample on for dynamic analysis. Here we have 4 options, a (magisk) rooted device <strong>not your daily device ITS A MALWARE REMEMBER?</strong>, an emulator, or an emulator running in a docker [11]</p>
<p>I always prefer a rooted device over emulator. But if you go with the emulator choice make sure you create an AVD without play store (google services) or else you wont have root instantly and you have to root it with magisk. You can always try <a href="https://github.com/shakalaca/MagiskOnEmulator">Magisk on Emulator</a>.</p>
<h3 id="references">References</h3>
<ul>
<li><a href="https://raw.githubusercontent.com/terminalforlife/Extra/master/source/simplify-ubuntu/simplify-ubuntu">01 - Debloat Script (Source)</a></li>
<li><a href="https://developer.android.com/studio">02 - Android Studio IDE (Official Site)</a></li>
<li><a href="https://developer.android.com/tools/releases/platform-tools">03 - Android SDK Platform Tools</a></li>
<li><a href="https://developer.android.com/tools/adb">04 - ADB and Fastboot Documentation (Android Docs)</a></li>
<li><a href="https://developer.android.com/tools/aapt2">05 - AAPT2 (Android Docs)</a></li>
<li><a href="https://github.com/Col-E/Recaf">06 - Recaf A Great Bytecode Editor (Github)</a></li>
<li><a href="https://github.com/CENSUS/ghidra-frida-hook-gen">07 - Ghidra Frida Hook Generator (Github)</a></li>
<li><a href="https://github.com/Ayrx/JNIAnalyzer">08 - JNIAnalyzer (Github)</a></li>
<li><a href="https://github.com/zackelia/ghidra-dark">09 - Ghidra Dark Theme (Github)</a></li>
<li><a href="https://github.com/skylot/jadx">10 - JADX (Github)</a></li>
<li><a href="https://www.youtube.com/watch?v=SWin67TZ4AY&amp;t=1s">11 - Easy Android Emulator in Docker (Video)</a></li>
</ul>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
